# 窗口基础

## Activity结构



![](C:\Users\wanglj\Desktop\Doucuments\recordLearning\资源图片\Android窗口结构.png)



## 分析Activity创建的过程

**是`Launcher`请求`AMS`过程、AMS到`ApplicationThread`的调用过程和`ActivityThread`启动`Activity`。**

### 窗体基础知识

每一个`Activity`都包含一个`window`对象，`Window`对象通常由`PhoneWidnow`实现。

`PhoneWindow`:将`Decorview`设置为整个应用窗口的根View,是`Window`的实现类，它是`Android`中最基本的窗口系统，每个`Activity`均会创建一个`PhoneWindow`对象，是`Activity`和整个`View`系统交互的接口

`DecorView`:顶层视图，将要显示的具体内容呈现在`PhoneWindow`上，`DecorView`是当前Activity所有`View`的祖先，它并不会向用户呈现任何东西，它主要有如下几个功能，

1.`Dispatch` `ViewRoot`分发来的`key`,`touch`,`trackball`等外部事件

2.`DecorView` 有一个直接的子`View`,我们称之为`System Layout`，这个View是从系统的`Layout.xml`中解析出来，它包含当前`Ui`的风格，如是否带`title`,是否带`process bar`等，可以称这些属性为`Window decorations`

3.作为`PhoneWindow`与`ViewRoot`之间的桥梁，`ViewRoot`通过`DecorView`设置窗口属性。//可以这样获取 `View view = getWindow().getDecorView();`

4.`DecorView`只有一个子元素为`LinearLayout`.代表整个Window界面，包含通知栏，标题栏，内容显示栏三块区域。`DecorView`里面的`TitleView`:标题，可以设置`requestWindowFeature(Window.FEATURE_NO_TITLE)`取消掉`ContentView` :是一个`id`为`content`的`FrameLayout`.我们平常在`Activity`使用的`setContentView`就是设置在这里，也就是在`Framelayout`上

### Window

查看Window源码核心部分

```java
public abstract class Window {
    ...
    @Nullable
    public View findViewById(@IdRes int id) {
        return getDecorView().findViewById(id);
    }

     public abstract void setContentView(@LayoutRes int layoutResID);
        public abstract void addContentView(View view, ViewGroup.LayoutParams params);
    public abstract void setBackgroundDrawable(Drawable drawable);
    public abstract void setTitle(CharSequence title);

}
```

`Window`是一个抽象类提供了一系列设置`Window`属性的抽象方法，而它唯一的实现类是`PhoneWindow`

```java
public class PhoneWindow extends Window 
```

