# C语言总结

## JNI

### JNI描述

- 定义:Java Native Interface,即Java本地接口
- 作用:使得Java与本地其他类型语言(如C,C++)交互
- JNI是Java调用Native语言的一种特性
- JNI是属于Java的，与Android无直接关系
- 实际中的驱动都是C/C++开发的，通过JNI，Java可以调用C/C++实现的驱动，从而扩展Java虚拟机的能力。另外，在高效率的数据运算，游戏的实时渲染，音视频的编码和解码等方面，一般都是C开发的

### 为什么要有JNI

- 实际使用中，Java需要与本地代码进行交互
- 因为Java具备跨平台的特点，所以Java与本地交互的能力非常弱
- 采用JNI特性增强Java与本地代码的交互能力

### 实现步骤

1. 在Java中声明Native方法(即需要调用的本地方法)
2. 编译上述Java源文件javac(得到.class文件)
3. 通过javah命令导出JNI的头文件(.h文件)
4. 使用Java需要交互的本地代码 实现在Java中声明的Native方法
5. 编译.so库
6. 通过java命令执行java程序，最终实现Java调用本地代码

## NDK概念

### NDK(c/c++接口)

- 定义:Native Development Kit,是Android的一个工具开发包
- 作用:快速开发C，C++的动态库，并自动将so和应用一起打包成APK
- 在Android的场景下 使用JNI
- 提供了把.so和.apk打包的工具
- NDK提供的库有限，仅拥有算法效率和敏感的问题
- 提供了交叉编译器，用于生成特定的CPU平台动态库

### 特点

- 运行效率高
- 代码安全性高
- 功能扩展性好
- 易于代码复用和移植

### C/C++文件编译过程

- #### 预处理

- ​	预处理阶段主要处理include和define等，它把#include包含进去的.h文件插入到#include所在的位置，吧程序中使用到的用#define定义的宏用实际的字符串代替

- #### 编译

- ​	汇编阶段，编译器检查代码的规范性，语法错误等,检查无误后，编译器把代码翻译成汇编语言

- #### 汇编

- 汇编阶段把.s文件翻译成二进制机器指令文件.so这个阶段接收.c,.i,.s的文件都没有问题

- #### 链接

- ​	链接阶段，链接的是其余的函数库，比如我们自己编写的c/c++文件中用到了三方的函数库，在连接阶段就需要连接第三方函数库，如果连接不到就会报错

### GCC编译C/C++的代码四个过程

预处理

gcc -E main.c -o main.i

编译阶段

gcc -S main.i -o man.s

汇编阶段

gcc -c main.s -o main.o

链接阶段

gcc main.o -o main.exe

### 静态库(static libarary ) linux下.a

通常情况下，对函数库的链接是放在编译时期(compile time)完成的，所有相关的对象文件(object file)与牵涉到的函数库(library)被链接合成一个可执行的文件(executable file) 。程序在运行时，与函数库无瓜葛，因为所有需要的函数库已经拷贝到自己门下，所以这些函数库被叫做静态函数库(static libaray).通常文件叫做'libXXXX.a'的形式

### 动态库(dynamic link library .so)

- 把一些函数库的链接载入推迟到程序员运行的时期(runtime)
- 可实现进程间的资源共享
- 将一些程序变的简单
- 甚至可以真正坐到链接载入完全由程序员在程序代码中控制

####动态库生成
将c生成.o</br>
gcc -c main.c main.o -fPIC</br>
使用gcc -shared生成动态库</br>
gcc -shared -o main.so main.o</br>
编译动态库到可执行文件</br>
gcc main.c -o a -l名称 -L./ -l动态库名称 -L制定库路径 </br>

### 交叉编译

#### 本地编译

在当前编译平台下，编译出来的程序只能放在当前平台下，比如，我们在X86平台上，编译程序并编译成可执行的程序，这种方式，我们使用X86平台上的工具，开发针对X86平台本身的可执行程序，这个编译过程叫做本地编译。

#### 交叉编译

在当前编译平台下，编译出来的程序能运行在体系结构不同的另一种目标平台上，但是编译平台本身却不能运行该程序，比如，我们在X86平台上，编译程序并编译成能运行在ARM平台程序，编译得到的程序在X86平台上是不能运行的，必须放在ARM平台上才能运行。

## NDK与JNI关系

JNI是实现Java调用C/C++的途径,NDK是Android中实现JNI的手段

即在Android的开发环境中，通过NDK从而实现JNI的功能

Java的优点是跨平台，和操作系统之间的调用由JVM完成，但是一些和操作系统相关的操作就无法完成，JNI的出现刚好弥补了这个缺陷，也完善了Java语言，将Java扩展得更强大。

## C/C++文件编译过程

预处理:预处理阶段主要处理include和define等。它把#include包含进来的.h文件插入到#include所在的位置，把源程序中使用到的用#define定义的宏用实际的字符串代替

编译:编译阶段，编译器检查代码的规范性，语法错误等，检查无误后，编译器把代码翻译成汇编语言

汇编:汇编阶段把.s文件翻译成二进制机器指令文件.o这个阶段接收.c,.i,.s的文件都没有问题。

链接:链接阶段，链接的是其余的函数库，比如我们自己编写的c/c++文件中用到了三方的函数库，在链接阶段就需要连接第三方函数库，比如连接不到就会报错

静态库（static library .a）

动态库链接库(dynamic link library .so)
